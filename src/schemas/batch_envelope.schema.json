{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "$id": "https://schemas.alteriom.io/mqtt/v1/batch_envelope.schema.json",
  "title": "Batch Envelope Schema",
  "description": "Schema for batching multiple MQTT messages into a single transmission to reduce protocol overhead and improve throughput",
  "type": "object",
  "required": [
    "schema_version",
    "message_type",
    "batch_id",
    "batch_size",
    "messages"
  ],
  "properties": {
    "schema_version": {
      "type": "integer",
      "const": 1,
      "description": "Schema version for compatibility tracking"
    },
    "message_type": {
      "type": "integer",
      "const": 800,
      "description": "Message type code for batch envelope (800)"
    },
    "batch_id": {
      "type": "string",
      "pattern": "^[a-zA-Z0-9_-]+$",
      "minLength": 1,
      "maxLength": 64,
      "description": "Unique identifier for this batch (UUID or similar)"
    },
    "batch_size": {
      "type": "integer",
      "minimum": 1,
      "maximum": 1000,
      "description": "Total number of messages in this batch"
    },
    "batch_index": {
      "type": "integer",
      "minimum": 0,
      "description": "Zero-based index of this batch in a multi-batch sequence (optional for single batch)"
    },
    "batch_timestamp": {
      "type": "string",
      "format": "date-time",
      "description": "ISO 8601 timestamp when the batch was created"
    },
    "compression": {
      "type": "string",
      "enum": ["none", "gzip", "zlib"],
      "default": "none",
      "description": "Compression algorithm applied to messages array"
    },
    "messages": {
      "type": "array",
      "minItems": 1,
      "maxItems": 1000,
      "description": "Array of individual MQTT messages (any valid schema)",
      "items": {
        "type": "object",
        "required": ["schema_version", "device_id"],
        "properties": {
          "schema_version": {
            "type": "integer"
          },
          "device_id": {
            "type": "string"
          }
        },
        "additionalProperties": true
      }
    },
    "metadata": {
      "type": "object",
      "description": "Optional batch-level metadata",
      "properties": {
        "total_batches": {
          "type": "integer",
          "minimum": 1,
          "description": "Total number of batches in a multi-batch sequence"
        },
        "priority": {
          "type": "integer",
          "minimum": 0,
          "maximum": 3,
          "description": "Batch priority (0=low, 1=normal, 2=high, 3=critical)"
        },
        "source": {
          "type": "string",
          "description": "Origin of the batch (gateway ID, aggregator ID)"
        }
      },
      "additionalProperties": true
    }
  },
  "additionalProperties": true
}
